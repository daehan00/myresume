# 코딩 규칙 및 컨벤션

## 1. 일반 규칙
- **인코딩**: UTF-8
- **언어**: 주석/문서화는 한국어, 식별자는 영어
- **네이밍**: 변수/함수(`snake_case`), 클래스(`PascalCase`), 상수(`SCREAMING_SNAKE_CASE`)
- **Python 버전**: 3.10 이상
- **가상환경**: `uv` 사용 (`.venv`), `pyproject.toml`로 의존성 관리

## 2. 코드 스타일
- **포맷팅**: PEP 8 준수 (들여쓰기 4공백, 최대 100자)
- **도구**: `black`(포맷팅), `isort`(import 정렬), `flake8`(린팅), `mypy`(타입체크) 사용
- **Import 순서**: 표준 라이브러리 -> 서드파티 -> 로컬 모듈 순으로 그룹화

## 3. 타입 힌트
- **필수 적용**: 함수 매개변수/반환값, 클래스 속성, 모듈 레벨 변수
- **검증**: `mypy` 검사 시 오류가 없어야 함

## 4. 문서화
- **Docstring**: Google 스타일 사용 (Args, Returns, Raises 명시)
- **주석**: "무엇을"이 아닌 "왜" 하는지를 설명, 복잡한 로직에만 작성

## 5. LangGraph 규칙
- **상태(State)**: `TypedDict`로 정의, 단계별 데이터 누적 구조 유지
- **노드(Node)**: `state`를 입력받아 업데이트할 필드만 포함된 `dict` 반환
- **엣지(Edge)**: 조건부 로직은 별도 함수로 분리하여 `add_conditional_edges` 사용

## 6. LangChain 규칙
- **프롬프트**: 코드 내 하드코딩 금지, 별도 설정 파일(`config/prompts.py`)에서 중앙 관리
- **출력 파싱**: `PydanticOutputParser` 사용하여 구조화된 데이터 추출
- **검증**: AI 출력에 대한 금지어/형식 검증 로직 필수 포함 (후처리 검증)

## 7. Streamlit 규칙
- **상태 관리**: `st.session_state`를 사용하여 단계별 데이터 및 플래그 관리
- **구조**: 페이지별 비즈니스 로직과 재사용 가능한 UI 컴포넌트(forms, display 등) 분리
- **UX**: 긴 작업 시 `st.spinner` 등으로 진행 상태 표시

## 8. 에러 처리
- **재시도**: LLM 생성 실패 또는 검증 실패 시 최대 3회 재시도 로직 구현
- **예외 처리**: 커스텀 예외(`AIOutputError` 등)를 정의하여 명시적으로 에러 전파

## 9. 테스트
- **프레임워크**: `pytest` 사용
- **명명 규칙**: `test_<동작>_<조건>_<기대결과>`

## 10. 환경 설정
- **관리**: `.env` 파일 사용 (버전 관리 제외)
- **로드**: `pydantic-settings`를 사용하여 타입 안전하게 로드

## 11. 커밋 규칙
- **형식**: `<타입>: <제목>` (예: `feat: 기능 추가`)
- **타입**: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`
